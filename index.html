<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Actuarial Guessing Dept ç²¾é¸ä¼°æ­Œéƒ¨</title>
    <style>
        :root { --pricing-pink: #ff007b; --actuary-blue: #00e5ff; --bg: #0d0d0d; }
        body { font-family: sans-serif; background-color: var(--bg); color: white; text-align: center; padding: 5px; margin: 0; overflow-x: hidden; }
        
        .screen { display: none; padding: 5px; min-height: 90vh; }
        .active { display: block; }

        .main-header { color: white; font-size: 22px; margin-top: 15px; margin-bottom: 15px; font-weight: bold; width: 100%; }

        /* Scoreboard */
        .timer-box { font-size: 32px; color: #666; font-family: monospace; font-weight: bold; width: 80px; display: flex; align-items: center; justify-content: center; }
        .timer-box.danger { color: #ff4757; text-shadow: 0 0 10px #ff4757; font-size: 48px; }
        .container { display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 10px; }
        .team-box { background: #1a1a1a; padding: 10px; border-radius: 15px; width: 35%; border: 1px solid #333; }
        .team-name { font-size: 14px; margin-bottom: 5px; outline: none; border-bottom: 1px dashed #444; }
        .score { font-size: 45px; font-weight: bold; margin: 2px 0; }
        
        button { cursor: pointer; border: none; border-radius: 8px; font-weight: bold; transition: 0.2s; }
        .btn-plus { background: var(--pricing-pink); color: white; width: 60px; height: 40px; font-size: 24px; }
        .btn-minus { background: #333; color: #888; width: 40px; height: 30px; font-size: 12px; margin-top: 4px; }

        /* Game Areas */
        .game-area { position: relative; width: 100%; max-width: 400px; aspect-ratio: 16/9; margin: 10px auto; border-radius: 12px; overflow: hidden; border: 1px solid #444; background: #000; }
        #black-shield { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; display: flex; flex-direction: column; justify-content: center; align-items: center; pointer-events: none; }
        #status-msg { font-size: 22px; color: #ff4757; font-weight: bold; }
        #player-target { width: 100%; height: 100%; }
        .card { background: white; color: #333; padding: 15px; border-radius: 15px; max-width: 400px; margin: 10px auto; }
        
        .main-btn { background: #e74c3c; color: white; width: 100%; padding: 15px; font-size: 18px; margin-bottom: 10px; border-radius: 12px; }
        .sub-btn { background: #555; color: white; flex: 1; padding: 10px; font-size: 12px; }
        .rev-btn { background: #28a745; color: white; flex: 1; padding: 10px; font-size: 12px; }
        .ans-box { background: #f0f0f0; border: 1px solid #ddd; margin-top: 5px; padding: 8px; border-radius: 8px; font-weight: bold; visibility: hidden; min-height: 20px; font-size: 14px; }
        #box-lyrics { color: #e74c3c; min-height: 85px; display: flex; align-items: center; justify-content: center; font-size: 20px; padding: 15px; border: 2px solid #ff4757; line-height: 1.4; }
        
        .small-round-btn { padding: 6px 12px; font-size: 13px; border-radius: 6px; margin: 4px; }
        .back-btn-r1 { background: #444; color: white; width: 100%; padding: 10px; border-radius: 12px; margin-top: 10px; font-size: 14px; }
        
        /* Progress Counter Style */
        .progress-text { font-size: 13px; color: #777; margin: 15px 0 5px 0; font-weight: bold; font-family: monospace; }

        /* Creator Studio Styles */
        .admin-input { width: 96%; padding: 8px; margin-bottom: 8px; border-radius: 5px; border: 1px solid #333; background: #222; color: white; font-size: 14px; }
        .home-card { background: #1a1a1a; padding: 25px; border-radius: 20px; border: 1px solid #333; margin: 15px auto; max-width: 350px; cursor: pointer; }
        .tab-btn { background: #333; color: #888; padding: 10px; flex: 1; border-radius: 0; font-size: 12px; border: 1px solid #444;}
        .tab-active { background: var(--actuary-blue); color: black; }
        #admin-test-area { height: 0; overflow: hidden; }
    </style>
</head>
<body>

    <div id="home-screen" class="screen active">
        <div class="main-header" style="margin-top: 50px; font-size: 26px; color: var(--actuary-blue);">
            Actuarial Guessing Dept <br> ç²¾é¸ä¼°æ­Œéƒ¨
        </div>
        <div class="home-card" onclick="showRules(1)"><h2>Round 1</h2><p>ä¼°æ­Œä»”</p></div>
        <div class="home-card" onclick="showRules(2)"><h2>Round 2</h2><p>æƒ…å¢ƒé¡Œ</p></div>
        <div class="home-card" onclick="showRules(3)"><h2>Round 3</h2><p>å”± Key Word</p></div>
        <button onclick="showAdmin()" style="background:#333; color:#aaa; margin-top:20px; padding:12px 20px; border-radius:30px; border:1px solid #444;">âš™ï¸ Creator Studio</button>
    </div>

    <div id="admin-screen" class="screen">
        <div id="admin-test-area"><div id="admin-player"></div></div>
        <div style="background:#1a1a1a; padding:15px; border-radius:20px; margin:5px auto; max-width:420px; border:2px solid var(--actuary-blue); min-height: 85vh;">
            <h2 style="color:var(--actuary-blue); margin-bottom:10px;">Creator Studio</h2>
            
            <div style="display:flex; margin-bottom:15px; border-radius:10px; overflow:hidden;">
                <button id="tab1" class="tab-btn tab-active" onclick="switchAdminTab(1)">R1: Songs</button>
                <button id="tab2" class="tab-btn" onclick="switchAdminTab(2)">R2: Topics</button>
                <button id="tab3" class="tab-btn" onclick="switchAdminTab(3)">R3: Keys</button>
            </div>

            <div id="admin-tab-1">
                <div style="text-align: left; background:#252525; padding:10px; border-radius:10px; margin-bottom:15px;">
                    <h4 style="color:var(--pricing-pink); margin-top:0;">Song Data Editor</h4>
                    <input id="in-id" class="admin-input" placeholder="YouTube Link or ID">
                    <div style="display:flex; gap:5px;">
                        <input id="in-start" type="number" class="admin-input" style="width:48%" placeholder="Start (sec)">
                        <input id="in-dur" type="number" class="admin-input" style="width:48%" placeholder="Dur (sec)">
                    </div>
                    <div style="display:flex; gap:5px;">
                        <input id="in-singer" class="admin-input" style="width:48%" placeholder="Singer">
                        <input id="in-title" class="admin-input" style="width:48%" placeholder="Song Title">
                    </div>
                    <input id="in-lyrics" class="admin-input" placeholder="Next Line (use ğŸ”´ğŸ”´)">
                    <input id="in-ans" class="admin-input" placeholder="Full Answer Line">
                    
                    <div style="display:flex; gap:5px;">
                        <button id="btn-add-song" class="main-btn" style="background:var(--pricing-pink); font-size:14px; padding:10px;" onclick="addOrUpdateSong()">ADD TO LIST</button>
                        <button id="btn-cancel-edit" class="main-btn" style="background:#555; font-size:14px; padding:10px; display:none;" onclick="cancelEdit()">CANCEL</button>
                    </div>
                </div>
                <h4 style="color:#666; margin:5px 0;">Session Playlist (<span id="song-count">0</span>)</h4>
                <div id="song-list-display" style="text-align:left; font-size:11px; background:#000; padding:10px; border-radius:10px; max-height:220px; overflow-y:auto;"></div>
            </div>

            <div id="admin-tab-2" style="display:none;">
                <h4 style="color:var(--pricing-pink)">R2 Topics</h4>
                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <input id="in-topic" class="admin-input" placeholder="Theme Name..." style="margin-bottom:0">
                    <button class="small-round-btn" style="background:var(--actuary-blue); color:black;" onclick="addCustomTopic()">ADD</button>
                </div>
                <div id="topic-list-display" style="text-align:left; font-size:12px; background:#000; padding:10px; border-radius:10px; height:300px; overflow-y:auto;"></div>
            </div>

            <div id="admin-tab-3" style="display:none;">
                <h4 style="color:var(--pricing-pink)">R3 Keywords</h4>
                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <input id="in-key" class="admin-input" placeholder="Word..." style="margin-bottom:0">
                    <button class="small-round-btn" style="background:var(--actuary-blue); color:black;" onclick="addCustomKeyword()">ADD</button>
                </div>
                <div id="key-list-display" style="text-align:left; font-size:12px; background:#000; padding:10px; border-radius:10px; height:300px; overflow-y:auto;"></div>
            </div>

            <div style="display:flex; gap:5px; margin-top:15px;">
                <button class="small-round-btn" style="background:#800; color:white; flex:1;" onclick="resetToDefault()">RESET ALL</button>
                <button class="small-round-btn" style="background:#444; color:white; flex:1;" onclick="exportPlaylist()">EXPORT</button>
                <button class="small-round-btn" style="background:#444; color:white; flex:1;" onclick="triggerImport()">IMPORT</button>
                <input type="file" id="import-file" style="display:none" onchange="importPlaylist(event)">
            </div>

            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="back-btn-r1" style="background:#28a745; flex:2;" onclick="saveAndExit()">SAVE & APPLY</button>
                <button class="back-btn-r1" style="background:#c0392b; flex:1;" onclick="discardAndExit()">DISCARD</button>
            </div>
        </div>
    </div>

    <div id="rules-overlay" class="screen">
        <div style="background:#1a1a1a; padding:30px; border-radius:20px; margin:20px auto; max-width:350px; border:2px solid var(--pricing-pink);">
            <h2 id="rule-title" style="color:var(--pricing-pink)">è¦å‰‡</h2>
            <div id="rule-content" style="text-align:left; line-height:1.8; color:#ccc; margin-bottom:25px; font-size: 15px;"></div>
            <button class="main-btn" onclick="startGame()" style="background:var(--pricing-pink); border:2px solid white;">Start</button>
            <button class="back-btn-r1" onclick="goHome()" style="background:transparent; border:1px solid #444; color:#888;">Back to Menu</button>
        </div>
    </div>

    <div id="game-ui" style="display:none;">
        <div class="main-header">Actuarial Guessing Dept</div>
        <div class="container">
            <div class="team-box" style="border-color: var(--pricing-pink);">
                <div class="team-name" contenteditable="true" style="color: var(--pricing-pink);">TEAM A</div>
                <div id="scoreA" class="score" style="color: var(--pricing-pink);">0</div>
                <button class="btn-plus" onclick="changeScore('scoreA', 1)">+</button><br>
                <button class="btn-minus" onclick="changeScore('scoreA', -1)">-1</button>
            </div>
            <div class="timer-box" id="timer">VS</div>
            <div class="team-box" style="border-color: var(--actuary-blue);">
                <div class="team-name" contenteditable="true" style="color: var(--actuary-blue);">TEAM B</div>
                <div id="scoreB" class="score" style="color: var(--actuary-blue);">0</div>
                <button class="btn-plus" onclick="changeScore('scoreB', 1)" style="background: var(--actuary-blue);">+</button><br>
                <button class="btn-minus" onclick="changeScore('scoreB', -1)">-1</button>
            </div>
        </div>

        <div id="round1-content" style="display:none;">
            <div class="game-area">
                <div id="black-shield"><div id="status-msg">Loading...</div></div>
                <div id="player-target"></div>
            </div>
            <div class="card">
                <button class="main-btn" onclick="syncStart()">â³ Click to Start</button>
                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <button class="sub-btn" onclick="replayLast()">ğŸ”„ Replay Last 5s</button>
                    <button class="sub-btn" style="background:#333;" onclick="stopSong()">â¹ STOP</button>
                </div>
                <div id="blanks" style="display:none; margin:15px 0;">
                    <div id="red-dots-line" style="color:#28a745; font-size:18px; font-weight:bold;"></div>
                </div>
                <div style="display:flex; justify-content:space-between; gap:5px;">
                    <button class="rev-btn" onclick="rev('singer')">1. æ­Œæ‰‹</button>
                    <button class="rev-btn" onclick="rev('title')">2. æ­Œå</button>
                    <button class="rev-btn" onclick="rev('lyrics')">3. ä¸‹ä¸€å¥</button>
                </div>
                <div id="box-singer" class="ans-box">æ­Œæ‰‹: ---</div>
                <div id="box-title" class="ans-box">æ­Œå: ---</div>
                <div id="box-lyrics" class="ans-box"></div>
                
                <div id="song-progress" class="progress-text">SONG 1 OF 32</div>
                
                <button class="main-btn" style="background:#000; margin-top:0;" onclick="nextSong()">NEXT SONG â”</button>
                <button class="back-btn-r1" onclick="goHome()">BACK TO MENU</button>
            </div>
        </div>

        <div id="generic-content" style="display:none;">
            <div id="topic-text" style="font-size: 28px; color: var(--pricing-pink); font-weight: bold; margin: 40px 0; min-height: 100px; display: flex; align-items: center; justify-content: center; padding: 20px; border: 2px dashed #333; border-radius: 15px;"></div>
            <div id="timer-display" style="font-size: 80px; font-family: monospace; color: #ff4757; margin: 20px 0; font-weight: bold;">10</div>
            <div>
                <button class="small-round-btn" style="background:#28a745; color:white;" onclick="start10sTimer()">START TIMER</button>
                <button class="small-round-btn" style="background:#555; color:white;" onclick="nextTopic()">NEXT ITEM</button>
            </div>
            <button class="small-round-btn" style="background:#444; color:white; margin-top:50px; opacity: 0.7;" onclick="goHome()">BACK TO MENU</button>
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player, adminPlayer, logicInt, idx = 0, currentRound = 0, topicIdx = 0;
        let editIndex = -1;

        const DEFAULT_SONGS = [
            {id:"URUIcYDq3_I", s:145, d:15, singer:"é™³å¥•è¿…", title:"é™€é£›è¼ª", lyrics:"ç§’é€ŸğŸ”´ğŸ”´ğŸ”´ğŸ”´ è€Œçš®è†šğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"ç§’é€Ÿæ‰å¾—ç·Šäº† è€Œçš®è†šç«Ÿå·å·é¬†äº†"},
            {id:"scHDBckJXv4", s:135, d:15, singer:"å¤å·¨åŸº", title:"å¿…æ®ºæŠ€", lyrics:"æ±‚ä½ ğŸ”´ğŸ”´ éŒ¯éæˆ‘ ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"æ±‚ä½ åˆ¥è¦ éŒ¯éæˆ‘ å…¶å¯¦æˆ‘ä¹Ÿä¸éŒ¯"},
            {id:"5wJFZBulzsI", s:131, d:14, singer:"å¼µæ•¬è»’", title:"æ«»èŠ±æ¨¹ä¸‹", lyrics:"äººç½®èº«ğŸ”´ğŸ”´ğŸ”´ğŸ”´ æŠ•å…¥ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"äººç½®èº«é€™å¤§æ™‚ä»£ æŠ•å…¥å¹¾ç•ªç«¶æŠ€è³½"},
            {id:"E9BgBB0JQ8E", s:128, d:20, singer:"å´ç”°", title:"å‘½ç¡¬", lyrics:"ç­‰ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´æ¯æ­»", ans:"ç­‰èŠæ£˜æ»¿é€”å…¨æ¯æ­»"},
            {id:"WJaufugjeSQ", s:86, d:26, singer:"æ¥Šåƒå¬…", title:"å°åŸå¤§äº‹", lyrics:"ä½ ä½•ä»¥ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"ä½ ä½•ä»¥é›™çœ¼å¥½åƒæµæ·š"},
            {id:"cPKfUWDmNbo", s:62, d:20, singer:"Twins", title:"ä¸‹ä¸€ç«™å¤©å", lyrics:"é›£åŠğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ğŸ”´ğŸ”´ğŸ”´ğŸ”´åœ°å”±", ans:"é›£åŠä»–åœ¨æˆ‘èº«é‚Š è²¼åˆ‡åœ°å”±"},
            {id:"onZjMJq4LhU", s:98, d:20, singer:"å®¹ç¥–å…’", title:"æˆ‘çš„é©•å‚²", lyrics:"å› ä½ ğŸ”´ğŸ”´ ğŸ”´ğŸ”´ğŸ”´", ans:"å› ä½ å‰µæ›´æ„‰å¿«"},
            {id:"v04DzjzSb5w", s:64, d:14, singer:"ç›§å·§éŸ³", title:"å¥½å¿ƒåˆ†æ‰‹", lyrics:"è‹¥æ³¨å®šğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ä¸å¦‚ğŸ”´ğŸ”´ğŸ”´ğŸ”´å‰²ç ´", ans:"è‹¥æ³¨å®šæœ‰ä¸€é»è‹¦æ¥š ä¸å¦‚è‡ªå·±è¦ªæ‰‹å‰²ç ´"},
            {id:"qu_FSptjRic", s:68, d:20, singer:"Beyond", title:"æµ·é—Šå¤©ç©º", lyrics:"å“ªğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ä½ ğŸ”´ğŸ”´æˆ‘", ans:"å“ªæœƒæ€•æœ‰ä¸€å¤©åªä½ å…±æˆ‘"},
            {id:"8dqdPHuFgfI", s:147, d:14, singer:"è˜‡æ°¸åº·", title:"è¶Šå»è¶Šå‚·å¿ƒ", lyrics:"ä½•å¿…ğŸ”´ğŸ”´ ğŸ”´ğŸ”´", ans:"ä½•å¿…è¿½å•é è¿‘"},
            {id:"JNocLV9gXuw", s:66, d:11, singer:"å‘¨åœ‹è³¢", title:"åœ°ä¸‹è¡—", lyrics:"ğŸ”´ğŸ”´å€‘ğŸ”´ğŸ”´åœ°ğŸ”´ğŸ”´", ans:"é€”äººå€‘ç›¸ç¹¼åœ°å›å®¶"},
            {id:"UlkToY0QfaU", s:38, d:20, singer:"éº¥æµšé¾", title:"æœ‰äºº", lyrics:"å¦‚ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´åˆ°", ans:"å¦‚æ²’æœ‰ä¿¡å¿ƒæ¥å—åˆ°"},
            {id:"VuvpCOL1hLQ", s:57, d:21, singer:"è¬éœ†é‹’", title:"å£ç¿’æ…£", lyrics:"è€Œé™½å…‰ğŸ”´ğŸ”´ ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ç•™ä½ä¸€æŠŠé›¨å‚˜", ans:"è€Œé™½å…‰ä¸€å‡º ç«Ÿä¸€å»ä¸è¿” ç•™ä½ä¸€æŠŠé›¨å‚˜"},
            {id:"yd_t2VRZMhU", s:1, d:25, singer:"é„­ä¸­åŸº", title:"æœ‰ç¨®", lyrics:"æœªæœªå¿…è¦åšğŸ”´ğŸ”´ ç¨±éœ¸ğŸ”´ğŸ”´ æ˜¯æˆ‘ğŸ”´ğŸ”´ğŸ”´", ans:"æœªå¿…è¦åšå¼·è€… ç¨±éœ¸æœ€å¼· æ˜¯æˆ‘ä¸æ€•ç—›"},
            {id:"IDywqSyQ3Mc", s:154, d:16, singer:"é„§éº—æ¬£", title:"é›»ç‡ˆè†½", lyrics:"è¦ğŸ”´ğŸ”´ğŸ”´åˆæŠ˜ğŸ”´", ans:"è¦èµ°çš„ä¸€å‰åˆæŠ˜è¿”"},
            {id:"CJ4fKSmOf3U", s:48, d:18, singer:"è˜‡æ°¸åº·", title:"é‚£èª°", lyrics:"æ·šç–Šæ·š ğŸ”´ğŸ”´ğŸ”´ æ¼¸è«è¾¨ ğŸ”´ğŸ”´", ans:"æ·šå æ·š é¢¨ä¸€å¹ æ¼¸è«è¾¨ é‚£~èª°"},
            {id:"1WLFhjQ0cDc", s:66, d:26, singer:"ç‹å‚‘", title:"ä¸æµªæ¼«ç½ªå", lyrics:"å¾ä¾†ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´å‹•è½", ans:"å¾ä¾†æœªå¯Ÿè¦ºæˆ‘èªæ°£å‹•è½"},
            {id:"f5NzXpC8tdU", s:52, d:12, singer:"å§œæ¿¤", title:"è’™è‘—å˜´èªªæ„›ä½ ", lyrics:"å¤©çµ¦æˆ‘ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ç¬‘è‘—å»ğŸ”´ğŸ”´", ans:"å¤©çµ¦æˆ‘è²§ç—…å›°è‹¦ ç¬‘è‘—å»åƒè‹¦"},
            {id:"YZPFbnk_RS0", s:225, d:19, singer:"MCå¼µå¤©è³¦", title:"è¨˜æ†¶æ£‰", lyrics:"æ˜å¤©ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´è¦", ans:"æ˜å¤©è¦‹ä¹Ÿæœ€å¥½ä¸è¦"},
            {id:"sg8V5BLMEhE", s:115, d:19, singer:"Dear Jane", title:"éŠ€æ²³ä¿®ç†å“¡", lyrics:"é€™ç¨®ğŸ”´ğŸ”´éğŸ”´ğŸ”´", ans:"é€™ç¨®å …å£¯éå …å£¯"},
            {id:"qWhavDVsMRc", s:133, d:11, singer:"æ—å®¶è¬™", title:"ä¸€äººä¹‹å¢ƒ", lyrics:"æ²‰é»˜ğŸ”´ğŸ”´ æœŸå¾…ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"æ²‰é»˜çœ‹æ˜Ÿ æœŸå¾…æ—¥å…‰ç‰½é ˜"},
            {id:"7FPL4DRizgk", s:188, d:13, singer:"Edan å‘‚çˆµå®‰", title:"Eå…ˆç”Ÿé€£ç’°ä¸å¹¸äº‹ä»¶", lyrics:"æ¼‚äº®é ç‡¦ğŸ”´é ä½ æˆ–æœƒğŸ”´ğŸ”´ æˆ‘ğŸ”´", ans:"æ¼‚äº®é ç‡¦çˆ›é ä½ æˆ–æœƒå–œæ­¡ æˆ‘æ‚¶"},
            {id:"Rp4iHpTvBY8", s:166, d:15, singer:"æ´ªå˜‰è±ª", title:"é»‘ç»ç’ƒ", lyrics:"ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´å…¬é–‹", ans:"æ¥å»æ¥åˆ°ç„¡æ³•å…¬é–‹"},
            {id:"vER4DPlhXXI", s:90, d:14, singer:"é™³è•¾", title:"å‡¡æ˜Ÿ", lyrics:"æˆæ•—èˆ‡å¦ğŸ”´ğŸ”´ğŸ”´ğŸ”´çœ‹ å¾ä¾†æ²’ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"æˆæ•—èˆ‡å¦çœ‹æˆ‘æ˜¯æ€éº¼çœ‹ å¾ä¾†æ²’æ¨™æº–ç­”æ¡ˆ"},
            {id:"falq0Gr3rc0", s:161, d:16, singer:"Gareth.T", title:"ç”¨èƒŒè„Šå”±æƒ…æ­Œ", lyrics:"æµäº¡ğŸ”´ğŸ”´çœ¼å‰ğŸ”´ğŸ”´ æ°¸æ†åœ¨è½‰ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"æµäº¡è’é‡çœ¼å‰éƒ½æœ‰ æ°¸æ†åœ¨è½‰é‚£ç¾£æœ¨é¦¬"},
            {id:"y9ntnHvD4tQ", s:135, d:19, singer:"å¼µæ•¬è»’", title:"éš±å½¢éŠæ¨‚å ´", lyrics:"ç³Šå¡—ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ä¸éœ€è¦ğŸ”´ğŸ”´ğŸ”´", ans:"ç³Šå¡—åœ°é—–å¤©åœ° ä¸éœ€è¦ä¸‰å¹…è¢«"},
            {id:"jrP24ZSYHts", s:126, d:12, singer:"æ—å®¶è¬™", title:"ç¥å¥‡çš„ç³Šå¡—é­”è—¥", lyrics:"ç­‰åˆ°ğŸ”´ğŸ”´é‚£å¤© ğŸ”´ğŸ”´æˆ‘æœƒğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"ç­‰åˆ°æ”¾æ™´çš„é‚£å¤© ä¹Ÿè¨±æˆ‘æœƒæ¯”è¼ƒå¥½ä¸€é»"},
            {id:"DYptgVvkVLQ", s:104, d:15, singer:"å‘¨æ°å€«", title:"æ™´å¤©", lyrics:"ç­‰åˆ°ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ ä¹Ÿè¨±æˆ‘æœƒğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"ç­‰åˆ°æ”¾æ™´çš„é‚£å¤© ä¹Ÿè¨±æˆ‘æœƒæ¯”è¼ƒå¥½ä¸€é»"},
            {id:"bu7nU9Mhpyo", s:43, d:32, singer:"å‘¨æ°å€«", title:"å‘Šç™½æ°£çƒ", lyrics:"è¦ªæ„›çš„ğŸ”´ğŸ”´ğŸ”´ ä½ çš„ğŸ”´ğŸ”´ åœ¨èªªæˆ‘ğŸ”´ğŸ”´", ans:"è¦ªæ„›çš„åˆ¥ä»»æ€§ ä½ çš„çœ¼ç› åœ¨èªªæˆ‘é¡˜æ„"},
            {id:"T4SimnaiktU", s:65, d:18, singer:"G.E.M.", title:"å…‰å¹´ä¹‹å¤–", lyrics:"æ²’æœ‰ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´è¦", ans:"æ²’æœ‰ä½ æ ¹æœ¬ä¸é‡è¦"},
            {id:"6aosRlnxg9I", s:129, d:24, singer:"ä»»è³¢é½Š.", title:"å°é¢çš„å¥³å­©çœ‹éä¾†", lyrics:"åŸä¾†ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans:"åŸä¾†æ¯å€‹å¥³å­©éƒ½ä¸ç°¡å–®"},
            {id:"GtDRcXtDg-4", s:89, d:20, singer:"äº”æœˆå¤©", title:"çªç„¶å¥½æƒ³ä½ ", lyrics:"çªç„¶ğŸ”´ğŸ”´ğŸ”´ğŸ”´ç›", ans:"çªç„¶æ¨¡ç³Šçš„çœ¼ç›"}
        ];

        let masterSongs = [...DEFAULT_SONGS];
        let r2Topics = ["å¤±æˆ€æœƒè½çš„æ­Œ", "é—œæ–¼è½é›¨çš„æ­Œ", "å……æ»¿æ­£èƒ½é‡çš„æ­Œ", "å…µæ­Œ", "é—œæ–¼æ—…è¡Œçš„æ­Œ"];
        let r3Keywords = ["æ­Œè©æœ‰äººé«”éƒ¨ä½ (æ‰‹/çœ¼/å’€...)", "é—œæ–¼é¡è‰² (ç´…/é»‘/ç™½...)", "æ­Œè©æœ‰æ„›å­—", "é—œæ–¼æ™‚é–“ (ç§’/åˆ†/é˜)", "é—œæ–¼å¤©æ°£ (æ™´/é›¨/é›²)"];

        let tempSongs = [], tempR2 = [], tempR3 = [];

        function extractYoutubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = String(url).match(regExp);
            return (match && match[2].length === 11) ? match[2] : url;
        }

        function showAdmin() {
            tempSongs = JSON.parse(JSON.stringify(masterSongs));
            tempR2 = [...r2Topics]; tempR3 = [...r3Keywords];
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('admin-screen').classList.add('active');
            switchAdminTab(1);
        }

        function switchAdminTab(n) {
            [1,2,3].forEach(i => {
                document.getElementById('admin-tab-'+i).style.display = (i===n) ? 'block' : 'none';
                document.getElementById('tab'+i).classList.remove('tab-active');
            });
            document.getElementById('tab'+n).classList.add('tab-active');
            if(n===1) updateSongListUI();
            if(n===2) updateTopicListUI();
            if(n===3) updateKeyListUI();
        }

        function saveAndExit() {
            if(confirm("Confirm: Save and apply all changes?")) {
                masterSongs = JSON.parse(JSON.stringify(tempSongs));
                r2Topics = [...tempR2]; r3Keywords = [...tempR3];
                goHome();
            }
        }

        function discardAndExit() { if(confirm("Discard all changes?")) goHome(); }

        function updateSongListUI() {
            const listDiv = document.getElementById('song-list-display');
            document.getElementById('song-count').innerText = tempSongs.length;
            listDiv.innerHTML = tempSongs.map((song, i) => `
                <div style="display:flex; justify-content:space-between; border-bottom:1px solid #222; padding:8px 0; align-items:center;">
                    <div style="flex:1; color:#aaa; font-size:10px;">${i+1}. ${song.title}</div>
                    <div style="display:flex; gap:8px;">
                        <button onclick="testSnippet(${i})" style="color:var(--actuary-blue); background:none; font-size:10px;">TEST</button>
                        <button onclick="loadSongForEdit(${i})" style="color:var(--pricing-pink); background:none; font-size:10px;">EDIT</button>
                        <button onclick="tempSongs.splice(${i},1); updateSongListUI();" style="color:red; background:none; font-size:10px;">âœ•</button>
                    </div>
                </div>
            `).join('');
        }

        function testSnippet(i) {
            const s = tempSongs[i];
            if(adminPlayer) adminPlayer.destroy();
            adminPlayer = new YT.Player('admin-player', {
                height: '0', width: '0', videoId: s.id,
                playerVars: { 'autoplay': 1, 'start': s.s },
                events: { 'onReady': (e) => { setTimeout(() => { e.target.stopVideo(); }, s.d * 1000); }}
            });
        }

        function loadSongForEdit(i) {
            editIndex = i; const s = tempSongs[i];
            document.getElementById('in-id').value = s.id; document.getElementById('in-start').value = s.s;
            document.getElementById('in-dur').value = s.d; document.getElementById('in-singer').value = s.singer;
            document.getElementById('in-title').value = s.title; document.getElementById('in-lyrics').value = s.lyrics;
            document.getElementById('in-ans').value = s.ans;
            document.getElementById('btn-add-song').innerText = "UPDATE SONG";
            document.getElementById('btn-cancel-edit').style.display = "block";
        }

        function cancelEdit() {
            editIndex = -1; ['in-id','in-start','in-dur','in-singer','in-title','in-lyrics','in-ans'].forEach(id => document.getElementById(id).value = "");
            document.getElementById('btn-add-song').innerText = "ADD TO LIST";
            document.getElementById('btn-cancel-edit').style.display = "none";
        }

        function addOrUpdateSong() {
            const data = { id: extractYoutubeId(document.getElementById('in-id').value), s: parseInt(document.getElementById('in-start').value) || 0, d: parseInt(document.getElementById('in-dur').value) || 15, singer: document.getElementById('in-singer').value || "Unknown", title: document.getElementById('in-title').value || "New Song", lyrics: document.getElementById('in-lyrics').value || "ğŸ”´ğŸ”´ğŸ”´ğŸ”´", ans: document.getElementById('in-ans').value || "..." };
            if(!data.id) return alert("Link/ID required");
            if(editIndex > -1) tempSongs[editIndex] = data; else tempSongs.push(data);
            cancelEdit(); updateSongListUI();
        }

        function updateTopicListUI() { document.getElementById('topic-list-display').innerHTML = tempR2.map((t, i) => `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #222;"><span>${t}</span><button onclick="tempR2.splice(${i},1); updateTopicListUI();" style="color:red; background:none;">âœ•</button></div>`).join(''); }
        function addCustomTopic() { const v = document.getElementById('in-topic').value; if(v){tempR2.push(v); document.getElementById('in-topic').value=""; updateTopicListUI();} }
        function updateKeyListUI() { document.getElementById('key-list-display').innerHTML = tempR3.map((t, i) => `<div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #222;"><span>${t}</span><button onclick="tempR3.splice(${i},1); updateKeyListUI();" style="color:red; background:none;">âœ•</button></div>`).join(''); }
        function addCustomKeyword() { const v = document.getElementById('in-key').value; if(v){tempR3.push(v); document.getElementById('in-key').value=""; updateKeyListUI();} }

        function showRules(r) {
            currentRound = r; 
            document.getElementById('home-screen').classList.remove('active'); 
            document.getElementById('rules-overlay').classList.add('active');
            let title = ""; let content = "";
            if (r === 1) {
                title = "Round 1 : ä¼°æ­Œä»”";
                content = "1. è½ 10-20 ç§’æ­Œæ›²ç‰‡æ®µ<br>2. çŒœå‡ºæ­Œæ‰‹ã€æ­Œåã€ä¸‹ä¸€å¥æ­Œè©<br>3. æ¯ä¸­ä¸€é …å¾— 1 åˆ†";
            } else if (r === 2) {
                title = "Round 2 : æƒ…å¢ƒé¡Œ";
                content = "1. æŠ½å‡ºä¸€å€‹æƒ…å¢ƒä¸»é¡Œ<br>2. å…©éšŠè¼ªæµå”±å‡ºç¬¦åˆä¸»é¡Œçš„æ­Œ<br>3. å¿…é ˆå”±å‡ºæœ€å°‘ä¸€å¥æ­Œè©<br>4. 10ç§’å…§æ¥ä¸åˆ°å‰‡è¼¸";
            } else if (r === 3) {
                title = "Round 3 : å”± Keywords";
                content = "1. æŠ½å‡ºä¸€å€‹æŒ‡å®šçš„é—œéµå­—<br>2. å…©éšŠè¼ªæµå”±å‡ºåŒ…å«è©²å­—çš„æ­Œ<br>3. å¿…é ˆå”±å‡ºæœ€å°‘ä¸€å¥æ­Œè©<br>4. 10ç§’å…§æ¥ä¸åˆ°å‰‡è¼¸";
            }
            document.getElementById('rule-title').innerText = title; 
            document.getElementById('rule-content').innerHTML = content;
        }

        function startGame() {
            document.getElementById('rules-overlay').classList.remove('active'); 
            document.getElementById('game-ui').style.display = 'block';
            if(currentRound === 1) { 
                document.getElementById('round1-content').style.display = 'block'; 
                document.getElementById('generic-content').style.display = 'none'; 
                shuffle(masterSongs); idx = 0; updateSongProgress(); loadVideo(); 
            } else { 
                document.getElementById('round1-content').style.display = 'none'; 
                document.getElementById('generic-content').style.display = 'block'; 
                topicIdx = 0; updateTopicDisplay(); 
            }
        }

        function updateSongProgress() {
            document.getElementById('song-progress').innerText = `SONG ${idx + 1} OF ${masterSongs.length}`;
        }

        function goHome() { 
            if(player) player.pauseVideo(); if(adminPlayer) adminPlayer.stopVideo(); 
            clearInterval(logicInt); 
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); 
            document.getElementById('home-screen').classList.add('active'); 
            document.getElementById('game-ui').style.display = 'none'; 
        }

        function loadVideo() {
            if(player) player.destroy(); document.getElementById('black-shield').style.display = 'flex'; 
            player = new YT.Player('player-target', { height: '100%', width: '100%', videoId: masterSongs[idx].id, playerVars: { 'autoplay': 0, 'controls': 0, 'playsinline': 1, 'start': masterSongs[idx].s },
                events: { 'onReady': (e) => { e.target.mute(); e.target.playVideo(); setTimeout(() => { e.target.pauseVideo(); e.target.unMute(); document.getElementById('status-msg').innerText = "Ready!"; }, 800); }}
            });
        }

        function syncStart() {
            player.seekTo(masterSongs[idx].s, true); player.playVideo(); document.getElementById('status-msg').innerText = "PLAYING..."; document.getElementById('blanks').style.display = 'none';
            let elapsed = 0; let duration = masterSongs[idx].d; clearInterval(logicInt);
            logicInt = setInterval(() => { elapsed++; let rem = duration - elapsed; if(rem <= 5 && rem > 0) { document.getElementById('timer').innerText = rem; document.getElementById('timer').classList.add('danger'); } if(elapsed >= duration) { clearInterval(logicInt); finishClip(); }}, 1000);
        }

        function finishClip() { player.pauseVideo(); document.getElementById('timer').innerText = "STOP"; document.getElementById('timer').classList.remove('danger'); document.getElementById('status-msg').innerText = "è«‹ä½œç­”"; document.getElementById('red-dots-line').innerText = masterSongs[idx].lyrics; document.getElementById('blanks').style.display = 'block'; }

        function rev(type) {
            const prefix = {singer: 'æ­Œæ‰‹: ', title: 'æ­Œå: ', lyrics: ''}; const val = type === 'lyrics' ? masterSongs[idx].ans : masterSongs[idx][type];
            document.getElementById('box-' + type).innerText = prefix[type] + val; document.getElementById('box-' + type).style.visibility = 'visible';
            if(type === 'lyrics') { document.getElementById('black-shield').style.display = 'none'; player.playVideo(); }
        }

        function nextSong() { 
            idx++; 
            if(idx >= masterSongs.length) { alert("Done!"); return goHome(); } 
            updateSongProgress();
            document.getElementById('blanks').style.display = 'none'; 
            ['singer','title','lyrics'].forEach(t => document.getElementById('box-'+t).style.visibility='hidden'); 
            document.getElementById('timer').innerText = "VS"; 
            loadVideo(); 
        }

        function shuffle(a) { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; } }
        function changeScore(id, amt) { let el = document.getElementById(id); let s = parseInt(el.innerText) + amt; el.innerText = s < 0 ? 0 : s; }
        function stopSong() { if(player) player.pauseVideo(); clearInterval(logicInt); }
        function replayLast() { if(player) { player.seekTo(masterSongs[idx].s + masterSongs[idx].d - 5); player.playVideo(); setTimeout(()=>player.pauseVideo(), 5000); } }
        function updateTopicDisplay() { const list = (currentRound === 2) ? r2Topics : r3Keywords; document.getElementById('topic-text').innerText = (currentRound === 2 ? "ä¸»é¡Œï¼š" : "é—œéµå­—ï¼š") + list[topicIdx]; document.getElementById('timer-display').innerText = "10"; }
        function start10sTimer() { let count = 10; document.getElementById('timer-display').innerText = count; clearInterval(logicInt); logicInt = setInterval(() => { count--; document.getElementById('timer-display').innerText = count; if(count <= 0) { clearInterval(logicInt); document.getElementById('timer-display').innerText = "OUT"; }}, 1000); }
        function nextTopic() { const list = (currentRound === 2) ? r2Topics : r3Keywords; topicIdx = (topicIdx + 1) % list.length; updateTopicDisplay(); clearInterval(logicInt); }
        function resetToDefault() { if(confirm("Reset everything?")) { tempSongs = [...DEFAULT_SONGS]; updateSongListUI(); } }
        function exportPlaylist() { const data = JSON.stringify({songs: tempSongs, r2: tempR2, r3: tempR3}); const blob = new Blob([data], {type: "text/plain"}); const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "backup.txt"; a.click(); }
        function triggerImport() { document.getElementById('import-file').click(); }
        function importPlaylist(e) { const file = e.target.files[0]; if(!file) return; const reader = new FileReader(); reader.onload = (ev) => { try { const d = JSON.parse(ev.target.result); if(d.songs) tempSongs = d.songs; if(d.r2) tempR2 = d.r2; if(d.r3) tempR3 = d.r3; updateSongListUI(); alert("Success"); } catch(e){ alert("Error"); }}; reader.readAsText(file); }
        function onYouTubeIframeAPIReady() {}
    </script>
</body>
</html>
